# 酒店员工管理系统

一个基于 Web 的酒店员工管理系统，使用 HTML、CSS、JavaScript 和 Supabase 构建，具有完整的用户认证功能。

## 功能特性

### 员工管理
- ✅ **增加员工**: 添加新员工信息（员工ID、姓名、薪资）
- ✅ **查询员工**: 通过员工ID查询员工信息
- ✅ **编辑员工**: 修改员工薪资
- ✅ **删除员工**: 删除指定员工
- ✅ **员工列表**: 显示所有员工信息

### 用户认证
- 🔐 **用户注册**: 支持邮箱注册和验证
- 🔑 **用户登录**: 安全的密码登录
- 🔄 **密码重置**: 通过邮箱重置密码
- 👤 **会话管理**: 自动登录状态检查和会话维护
- 🚪 **安全登出**: 完整的登出流程

### 用户体验
- ✅ **响应式设计**: 支持桌面和移动设备
- ✅ **中文界面**: 完全中文化的用户界面
- ✅ **现代化UI**: 渐变色彩和平滑动画
- ✅ **实时反馈**: 加载状态和消息提示

### 协作功能
- 👥 **多用户协作**: 所有认证用户共享同一张员工表
- 🔄 **实时同步**: 数据变化实时同步到所有用户
- 📢 **操作通知**: 显示其他用户的操作活动
- 👀 **在线状态**: 显示当前在线用户列表
- 📝 **操作日志**: 记录所有用户的操作历史
- 👤 **操作追踪**: 显示每个员工记录的创建者和更新者

## 技术栈

- **前端**: HTML5 + CSS3 + JavaScript (ES6+)
- **数据库**: Supabase (PostgreSQL)
- **样式**: 现代响应式设计
- **API**: Supabase JavaScript Client

## 项目结构

```
hotel-membership-system/
├── index.html              # 主应用页面
├── login.html              # 登录/注册页面
├── reset-password.html      # 密码重置页面
├── check-table.html        # 数据库表检查工具
├── get-table-structure.html # 表结构获取工具
├── css/
│   ├── style.css           # 主应用样式
│   └── auth.css            # 认证页面样式
├── js/
│   ├── app.js              # 主应用逻辑（含认证）
│   └── auth.js             # 认证功能逻辑
├── assets/                 # 资源文件
├── README.md               # 项目说明
├── CLAUDE.md               # Claude Code 指导文档
└── AUTH_SETUP.md           # 认证设置指南
```

## 快速开始

### 1. 获取 Supabase 配置

1. 访问 [Supabase](https://supabase.com) 并登录
2. 创建新项目或使用现有项目
3. 在项目设置中获取：
   - Project URL
   - API Keys (anon/public)

### 2. 配置认证系统

⚠️ **重要**: 首次使用前请按照 [AUTH_SETUP.md](./AUTH_SETUP.md) 配置Supabase认证设置：

- 启用邮箱/密码认证
- 配置邮箱验证
- 设置重定向URL
- 配置邮件模板（可选）

### 3. 配置数据库

确保您的 Supabase 项目中有 `members` 表，结构如下：

```sql
-- 员工表
CREATE TABLE members (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  employee_id INTEGER UNIQUE NOT NULL,
  employee_name VARCHAR(100) NOT NULL,
  employee_salary NUMERIC DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  created_by UUID REFERENCES auth.users(id),
  updated_by UUID REFERENCES auth.users(id)
);

-- 活动日志表
CREATE TABLE activity_logs (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  user_email TEXT NOT NULL,
  action TEXT NOT NULL CHECK (action IN ('CREATE', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT')),
  target_type TEXT NOT NULL,
  target_id TEXT,
  details JSONB DEFAULT '{}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 4. 配置应用

编辑 `js/app.js` 和 `js/auth.js` 文件中的 Supabase 配置：

```javascript
// Supabase 配置 - 请替换为你的实际配置
const SUPABASE_URL = 'https://your-project-id.supabase.co';
const SUPABASE_ANON_KEY = 'your-anon-key';
```

### 5. 运行应用

由于这是一个纯前端应用，您有以下几种运行方式：

#### 方式一：直接打开（推荐用于测试）
```bash
# 在项目目录中
start index.html  # Windows
open index.html   # macOS
```

#### 方式二：使用本地服务器（推荐）
```bash
# 使用 Python
python -m http.server 8000

# 使用 Node.js (需要先安装 http-server)
npx http-server

# 或使用 Live Server (VS Code 扩展)
```

然后在浏览器中访问 `http://localhost:8000`

## 功能说明

### 用户认证
1. 访问 `login.html` 进行登录或注册
2. 新用户需通过邮箱验证完成注册
3. 登录成功后自动跳转到主系统

### 多用户协作

#### 员工管理
- **新增员工**: 所有认证用户可添加新员工，系统会记录创建者
- **查询员工**: 实时显示所有员工信息，包括创建者和最后更新者
- **编辑员工**: 任何用户可修改员工薪资，更新会记录操作者
- **删除员工**: 支持删除员工记录，操作会被记录

#### 实时协作功能
- **实时同步**: 当任何用户修改数据时，其他用户界面会实时更新
- **操作通知**: 页面顶部会显示其他用户的操作（如："张三 添加了新员工 李四"）
- **在线状态**: 显示当前在线的用户数量和邮箱
- **操作历史**: 系统记录所有用户的详细操作日志

#### 数据追踪
- **创建者追踪**: 每条员工记录显示创建该记录的用户
- **更新者追踪**: 显示最后修改该记录的用户和时间
- **操作日志**: 记录登录、登出、增删改等所有操作

### 使用场景示例

#### 场景1：多部门协作
- 人事部用户可以添加新员工
- 财务部用户可以更新薪资信息
- 所有变更实时同步给相关人员

#### 场景2：移动办公
- 用户A在办公室添加员工记录
- 用户B在家中可以立即看到新记录
- 支持多人同时管理员工数据

## 浏览器兼容性

- Chrome (推荐)
- Firefox
- Safari
- Edge

## 安全注意事项

1. **API 密钥保护**: 虽然使用的是匿名密钥，但请确保在 Supabase 中正确配置 RLS (Row Level Security)
2. **数据验证**: 前端已包含基本验证，但建议在 Supabase 中设置数据验证规则
3. **权限控制**: 根据需要设置不同的用户权限

## 部署说明

### 部署到静态托管服务

该项目可以轻松部署到任何静态托管服务：

1. **GitHub Pages**
2. **Netlify**
3. **Vercel**
4. **Firebase Hosting**
5. **任何支持静态文件的 Web 服务器**

### 部署步骤

1. 将项目文件上传到您选择的托管服务
2. 确保 `js/app.js` 中的 Supabase 配置正确
3. 部署完成！

## 故障排除

### 常见问题

1. **"数据库连接失败"**
   - 检查 Supabase URL 和 API 密钥是否正确
   - 确保 Supabase 项目正在运行
   - 检查网络连接

2. **"未找到会员"**
   - 确认会员ID输入正确
   - 检查数据库中是否存在该记录

3. **"会员ID已存在"**
   - 每个会员ID必须是唯一的
   - 请使用不同的ID或先删除现有会员

### 调试方法

1. 打开浏览器开发者工具 (F12)
2. 查看 Console 标签页的错误信息
3. 检查 Network 标签页的 API 请求

## 更新日志

### v1.0.0
- 初始版本发布
- 实现基本的 CRUD 功能
- 响应式设计
- 中文界面支持

## 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 Issue
- 发送邮件

## 许可证

MIT License